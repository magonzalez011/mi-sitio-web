<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orden de Servicio Le Pain Quotidien</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { 
        background: #e8f1f8; 
        font-family: Arial, sans-serif;
    }
    .form-container { 
        background-image: url("img/hospital.jpg"); 
        background-size: cover; 
        background-repeat: no-repeat; 
        background-position: left; 
        padding: 25px; 
        border-radius: 12px; 
        box-shadow: 0px 3px 10px rgba(0,0,0,0.1); 
        max-width: 1200px; 
        margin: auto;
    }
    img.logo {
        display: block;
        margin: 0 auto 20px auto;
        max-height: 80px;
    }
    table {
        width: 100%;
        background: rgba(255,255,255,0.9);
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 0.9rem;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 6px 8px;
        text-align: left;
        vertical-align: middle;
    }
    th {
        background-color: #053563;
        color: white;
        font-size: 0.95rem;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr.filtro {
        background-color: #cce5ff !important;
    }
    .filter-row .form-control {
        margin-bottom: 10px;
    }
    .btn-actualizar { background-color: #053563; color: white; }
    .btn-comanda { background-color: #045216; color: white; }
    .btn-fecha { background-color: #040b0c; color: white; }
    .btn-habitacion { background-color: #470410; color: white; }
</style>
</head>
<body>

<div class="container my-4">
    <div class="form-container">
        <img src="img/LOGO.jfif" class="logo" alt="Logo">

        <h1 class="text-center mb-4" style="color:#053563; font-weight: bold;">Ordenes de Servicio</h1>

        <div class="row filter-row mb-3">
            <div class="col-md-3">
                <input type="number" class="form-control" id="comandaInicio" placeholder="Número Comanda Inicio">
            </div>
            <div class="col-md-3">
                <input type="number" class="form-control" id="comandaFin" placeholder="Número Comanda Fin">
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" id="filtroHabitacion" placeholder="Habitación">
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" id="fechaInicio">
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" id="fechaFin">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-3 mb-2">
                <button class="btn btn-actualizar w-100" onclick="consultarTodos()">Actualizar Todo</button>
            </div>
            <div class="col-md-3 mb-2">
                <button class="btn btn-comanda w-100" onclick="consultarPorComanda()">Buscar por Comanda</button>
            </div>
            <div class="col-md-3 mb-2">
                <button class="btn btn-habitacion w-100" onclick="consultarPorHabitacion()">Buscar por Habitación</button>
            </div>
            <div class="col-md-3 mb-2">
                <button class="btn btn-fecha w-100" onclick="consultarPorFecha()">Buscar por Fecha</button>
            </div>
        </div>

        <div id="resultados">
            <table id="tablaResultados">
                <thead>
                    <tr>
                        <th>No Comanda</th>
                        <th>Timestamp</th>
                        <th>Fecha</th>
                        <th>Habitación</th>
                        <th>Alergias</th>
                        <th>Tiempo Comida</th>
                        <th>Alimento</th>
                        <th>Estado</th>
    </tr>
</thead>

                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwmHr2WWSLxE9LnHArOvinSlCZxvLUPOtSK3dVuiQKU-oTgBKqg4maBmuGSOkjA9kHe5A/exec"; // Reemplazar con tu Web App

function formatoFechaCorta(fecha) {
    return fecha || "";
}

async function cargarDatos(url, filtro=false) {
    const tbody = document.querySelector("#tablaResultados tbody");
    tbody.innerHTML = "<tr><td colspan='7'>Cargando...</td></tr>";

    try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data || data.length === 0) {
            tbody.innerHTML = "<tr><td colspan='7'>No se encontraron registros.</td></tr>";
            return;
        }

        tbody.innerHTML = "";
        data.forEach(r => {
            const fila = document.createElement("tr");
            if(filtro) fila.classList.add("filtro");
            fila.innerHTML = `
                <td>${r.NumeroComanda}</td>
                <td>${r.Timestamp || ""}</td>
                <td>${formatoFechaCorta(r.Fecha)}</td>
                <td>${r.Habitacion}</td>
                <td>${r.Alergias || ""}</td>
                <td>${r.TiempoComida}</td>
                <td>${r.Alimento || ""}</td>
                <td>${r.Estado}</td>
            `;
            tbody.appendChild(fila);
        });

    } catch(err) {
        console.error(err);
        tbody.innerHTML = "<tr><td colspan='7'>Error al cargar datos.</td></tr>";
    }
}

function consultarTodos() {
    cargarDatos(SCRIPT_URL + "?accion=consultar");
}

function consultarPorComanda() {
    const inicio = document.getElementById("comandaInicio").value;
    const fin = document.getElementById("comandaFin").value;
    if (!inicio || !fin) { alert("Ingrese rango de comanda"); return; }
    const url = `${SCRIPT_URL}?accion=porComanda&inicio=${inicio}&fin=${fin}`;
    cargarDatos(url, true);
}

function consultarPorHabitacion() {
    const habitacion = document.getElementById("filtroHabitacion").value.trim();
    if (!habitacion) { alert("Ingrese habitación"); return; }
    const url = `${SCRIPT_URL}?accion=porHabitacion&habitacion=${encodeURIComponent(habitacion)}`;
    cargarDatos(url, true);
}

function consultarPorFecha() {
    const inicio = document.getElementById("fechaInicio").value;
    const fin = document.getElementById("fechaFin").value;
    if (!inicio || !fin) { alert("Ingrese rango de fechas"); return; }
    const url = `${SCRIPT_URL}?accion=porFecha&inicio=${inicio}&fin=${fin}`;
    cargarDatos(url, true);
}

// Carga inicial
window.onload = consultarTodos;
</script>

</body>
</html>
